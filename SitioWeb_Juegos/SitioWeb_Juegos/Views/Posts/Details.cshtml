@model Datos.Posts


@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
                @Model.Titulo
            </h1>
            <ol class="breadcrumb">
                <li>
                    @Html.ActionLink("Home", "Index", "Posts")
                </li>
                <li class="active">Blog Post</li>
            </ol>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-8">
            <!-- the actual blog post: title/author/date/content -->
            <hr>
            <p>
                <i class="fa fa-clock-o">@Model.FechaPublicacion</i> Autor @Model.AspNetUsers.UserName
            </p>
            <hr>
            <img class="img-responsive" src="@Model.Juegos.Imagen">
            <hr>
            <p>@Model.Contenido</p>


            <strong>Tags:</strong>

            <ul>
                <li>
                    <a href="http://spaceipsum.com/">Space Ipsum</a>
                </li>
                <li>
                    <a href="http://cupcakeipsum.com/">Cupcake Ipsum</a>
                </li>
                <li>
                    <a href="http://tunaipsum.com/">Tuna Ipsum</a>
                </li>
            </ul>
            <hr>
            @if (User.Identity.IsAuthenticated)
            {
                <div class="well">
                    <h4>Comentarios:</h4>
                    <form role="form">
                        <div class="form-group">
                            <textarea id="Comentario" typeof="text" rows="3" class="form-control"></textarea>
                        </div>
                        <button class="btn btn-primary" id="BtnComentar" type="submit">Comentar</button>
                    </form>
                </div>
            }
            else
            {
                <h2>Tiene que estar logeado para comentar</h2>
                @Html.ActionLink("Iniciar Sesion", "Login", "Account")
            }


            <!-- Lista todos los comentarios -->
                <div class="media">
                    @foreach (var item in Model.Comentarios.ToList().Where(x => x.Estados.Descripcion == "Activo"))
                    {
                        <a class="pull-left">
                            @item.AspNetUsers.UserName
                        </a>
                        <div class="media-body">

                            <h4 class="media-heading">
                                <small>
                                    @item.FechaPublicacion
                                </small>
                            </h4>
                            @item.Contenido  

                            @if (User.Identity.Name == item.AspNetUsers.UserName)
                            {
                                <a class="btn btn-group" id="BtnEliminar" type="submit" href="@Url.Action("EliminarComentario","Posts",new { Id = item.Id })">Eliminar</a>
                            }
                            else
                            {
                                <a class="btn btn-group" id="BtnDenunciar" type="submit" href="@Url.Action("Denunciar","Posts",new { id = item.Id })">Denunciar</a>
                            }
                        </div>


                    }


                </div>

            <hr>


            <!-- the comments -->

        </div>
        <div class="col-lg-4">
            <div class="well">
                <h4>Blog Search</h4>
                <div class="input-group">
                    <input type="text" class="form-control">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default">
                            <i class="fa fa-search"></i>
                        </button>
                    </span>
                </div>
                <!-- /input-group -->
            </div>
            <!-- /well -->
            <div class="well">
                <h4>Popular Blog Categories</h4>
                <div class="row">
                    <div class="col-lg-6">
                        <ul class="list-unstyled">
                            <li>
                                <a href="#dinosaurs">Dinosaurs</a>
                            </li>
                            <li>
                                <a href="#spaceships">Spaceships</a>
                            </li>
                            <li>
                                <a href="#fried-foods">Fried Foods</a>
                            </li>
                            <li>
                                <a href="#wild-animals">Wild Animals</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-lg-6">
                        <ul class="list-unstyled">
                            <li>
                                <a href="#alien-abductions">Alien Abductions</a>
                            </li>
                            <li>
                                <a href="#business-casual">Business Casual</a>
                            </li>
                            <li>
                                <a href="#robots">Robots</a>
                            </li>
                            <li>
                                <a href="#fireworks">Fireworks</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /well -->
            <div class="well">
                <h4>Side Widget Well</h4>
                <p>Bootstrap's default well's work great for side widgets! What is a widget anyways...?</p>
            </div>
            <!-- /well -->
        </div>
    </div>
</div>

<!-- Hace la magia para comentar y ver el comentario creado -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript">
    $(function() {
        $("#BtnComentar").click(function () {
            var comment = $("#Comentario").val();
            if (comment.trim() != "") //Se puede ingresar espacios y el comentario se guarda igual, el .trim elimina el espacio en blanco y verifica si es vacio
            {
                $.ajax({
                    url: '/Posts/CrearComentario/',
                    data: { Comentario: comment, IdPost:@Model.Id},
                    type: 'POST',
                    dataType: 'json',
                    success: function (data) {
                        alert("Gracias por Comentar!");
                    }
                })
            }
            else {
                alert("Error! Comentario Vacio");
            }

        })
    });
</script>
